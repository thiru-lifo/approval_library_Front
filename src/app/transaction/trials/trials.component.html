<section class="body-card">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <div class="row">
              <div class="col-md-6">
                <h3>Transaction List</h3>
              </div>
              <div class="col-md-6">
                <div class="text-right">
                  <a
                    href="#"
                    data-toggle="modal"
                    data-target="#crud-countries"
                    (click)="create()"
                    class="btn btn-primary btn-round-sm"
                    *ngIf="permission.add == true"
                    >Initiate</a
                  >
                </div>
              </div>
            </div>
          </div>

          <div class="tabs-external tabstyle2">
            <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
              <li [ngbNavItem]="1">
                <a
                  ngbNavLink
                  (click)="showPending()"
                  class="bg-danger text-white"
                  >Pending</a
                >
                <ng-template ngbNavContent>
                  <div class="container table-options">
                    <div class="row">
                      <div class="col-md-6">
                        <mat-paginator
                          [length]="totalLength"
                          [pageSize]="10"
                          (page)="pageEvent = $event"
                          (page)="getTrialsPending()"
                          [pageSizeOptions]="[10, 20, 30, 50, 100]"
                          aria-label="Select page"
                        >
                        </mat-paginator>
                      </div>
                      <div class="col-md-6">
                        <div appearance="standard">
                          <!--<mat-label>Search Only Trial Number</mat-label>-->
                          <input
                            matInput
                            (keyup)="applyFilterPending($event)"
                            placeholder="Search Only Trial Number"
                            class="search-mat-table"
                            #input
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <table
                    mat-table
                    [dataSource]="dataSourcePending"
                    class="mat-elevation-z8"
                  >
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Transaction Name </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{ country.name }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="requested_by">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Requested By </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{
                          country.created_by__first_name +
                            " " +
                            country.created_by__last_name
                        }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="requested_on">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Requested On </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{
                          moment(country.created_on).format(
                            "DD-MM-YYYY hh:mm A"
                          )
                        }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="status">
                      <th mat-header-cell *matHeaderCellDef><b> Status </b></th>
                      <td mat-cell *matCellDef="let country">
                        <a
                          href="javascript:void(0)"
                          class="status-field {{
                            country.status == '1'
                              ? 'text-success'
                              : 'text-danger'
                          }}"
                          >{{
                            country.status == "1" ? "Active" : "Inactive"
                          }}</a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="rec">
                      <th mat-header-cell *matHeaderCellDef>
                        <b>Recommender</b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        <a
                          href="javascript:void(0)"
                          title="Recommendation"
                          (click)="openApprovalForm(country)"
                          class="edit-icon text-primary"
                          style="padding: 5px; background: #5d49d9"
                          ><span
                            class="material-icons-outlined"
                            style="color: #fff"
                            >sailing</span
                          ></a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="view">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.view == true"
                          ><b>View</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-primary"
                          data-toggle="modal"
                          data-target="#crud-countries"
                          *ngIf="permission.view == true"
                          (click)="onView(country)"
                          ><span class="material-icons-outlined"
                            >remove_red_eye</span
                          ></a
                        >
                      </td>
                      <!-- <td class="text-center" mat-cell *matCellDef="let country">
                              <a href="#" data-toggle="modal" data-target="#crud-countries" class="edit-icon text-primary" *ngIf="permission.view==true" (click)="onView(country)"><span class="material-icons-outlined">remove_red_eye</span></a></td> -->
                    </ng-container>
                    <ng-container matColumnDef="edit">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.edit == true"
                          ><b>Edit</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-primary"
                          data-toggle="modal"
                          data-target="#crud-countries"
                          (click)="editOption(country)"
                          *ngIf="permission.edit == true"
                          ><span class="material-icons-outlined">edit</span></a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="delete">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.delete == true"
                          ><b>Delete</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-danger"
                          (click)="onDelete(country.id)"
                          *ngIf="permission.delete == true"
                          ><span class="material-icons-outlined"
                            >delete</span
                          ></a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="noData">
                      <th
                        mat-footer-cell
                        *matFooterCellDef
                        [attr.colspan]="displayedColumnsPending.length"
                        class="norecord"
                      >
                        No Records Found!
                      </th>
                    </ng-container>
                    <tr
                      mat-header-row
                      *matHeaderRowDef="displayedColumnsPending"
                    ></tr>
                    <ng-container *ngIf="dataListPending.length > 0">
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumnsPending"
                      ></tr>
                    </ng-container>
                    <tr
                      mat-footer-row
                      *matFooterRowDef="['noData']"
                      [hidden]="
                        dataSourcePending && dataSourcePending.data.length > 0
                      "
                    ></tr>
                    <!-- <tr class="mat-row" *matNoDataRow>
                           <td *ngIf='filterValue' class="norecord"  colspan="4"><b>No data matching with "{{input.value}}"</b></td>
                        </tr> -->
                  </table>
                </ng-template>
              </li>
              <li [ngbNavItem]="2">
                <a
                  ngbNavLink
                  (click)="showApproved()"
                  class="bg-success text-white"
                  >Approved</a
                >
                <ng-template ngbNavContent>
                  <div class="container table-options">
                    <div class="row">
                      <div class="col-md-6">
                        <mat-paginator
                          [length]="totalLength"
                          [pageSize]="10"
                          (page)="pageEvent = $event"
                          (page)="getTrialsApproved()"
                          [pageSizeOptions]="[10, 20, 30, 50, 100]"
                          aria-label="Select page"
                        >
                        </mat-paginator>
                      </div>
                      <div class="col-md-6">
                        <div appearance="standard">
                          <!--<mat-label>Search Only Trial Number</mat-label> -->
                          <input
                            matInput
                            (keyup)="applyFilterApproved($event)"
                            placeholder="Search Only Trial Number"
                            class="search-mat-table"
                            #input
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                  <table
                    mat-table
                    [dataSource]="dataSourceApproved"
                    class="mat-elevation-z8"
                  >
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Trial No </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{ country.name }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="requested_by">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Requested By </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{
                          country.created_by__first_name +
                            " " +
                            country.created_by__last_name
                        }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="requested_on">
                      <th mat-header-cell *matHeaderCellDef>
                        <b> Requested On </b>
                      </th>
                      <td mat-cell *matCellDef="let country">
                        {{
                          moment(country.created_on).format(
                            "DD-MM-YYYY hh:mm A"
                          )
                        }}
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="status">
                      <th mat-header-cell *matHeaderCellDef><b> Status </b></th>
                      <td mat-cell *matCellDef="let country">
                        <a
                          href="javascript:void(0)"
                          class="status-field {{
                            country.status == '1'
                              ? 'text-success'
                              : 'text-danger'
                          }}"
                          >{{
                            country.status == "1" ? "Active" : "Inactive"
                          }}</a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="view">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.view == true"
                          ><b>View</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-primary"
                          data-toggle="modal"
                          data-target="#crud-countries"
                          *ngIf="permission.view == true"
                          (click)="onView(country)"
                          ><span class="material-icons-outlined"
                            >remove_red_eye</span
                          ></a
                        >
                      </td>
                      <!-- <td class="text-center" mat-cell *matCellDef="let country">
                              <a href="#" data-toggle="modal" data-target="#crud-countries" class="edit-icon text-primary" *ngIf="permission.view==true" (click)="onView(country)"><span class="material-icons-outlined">remove_red_eye</span></a></td> -->
                    </ng-container>
                    <ng-container matColumnDef="edit">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.edit == true"
                          ><b>Edit</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-primary"
                          data-toggle="modal"
                          data-target="#crud-countries"
                          (click)="editOption(country)"
                          *ngIf="permission.edit == true"
                          ><span class="material-icons-outlined">edit</span></a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="delete">
                      <th class="text-center" mat-header-cell *matHeaderCellDef>
                        <ng-container *ngIf="permission.delete == true"
                          ><b>Delete</b></ng-container
                        >
                      </th>
                      <td
                        class="text-center"
                        mat-cell
                        *matCellDef="let country"
                      >
                        <a
                          href="javascript:void(0)"
                          class="edit-icon text-danger"
                          (click)="onDelete(country.id)"
                          *ngIf="permission.delete == true"
                          ><span class="material-icons-outlined"
                            >delete</span
                          ></a
                        >
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="noData">
                      <th
                        mat-footer-cell
                        *matFooterCellDef
                        [attr.colspan]="displayedColumnsApproved.length"
                        class="norecord"
                      >
                        No Records Found!
                      </th>
                    </ng-container>
                    <tr
                      mat-header-row
                      *matHeaderRowDef="displayedColumnsApproved"
                    ></tr>
                    <ng-container *ngIf="dataListApproved.length > 0">
                      <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumnsApproved"
                      ></tr>
                    </ng-container>
                    <tr
                      mat-footer-row
                      *matFooterRowDef="['noData']"
                      [hidden]="
                        dataSourceApproved && dataSourceApproved.data.length > 0
                      "
                    ></tr>
                    <tr class="mat-row" *matNoDataRow>
                      <!-- <td *ngIf='filterValue' class="norecord"  colspan="4"><b>No data matching with "{{input.value}}"</b></td> -->
                    </tr>
                  </table>
                </ng-template>
              </li>
            </ul>

            <div [ngbNavOutlet]="nav" class="mt-2"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- modal -->
<div
  class="modal fade master-modal-style"
  id="crud-countries"
  data-keyboard="false"
  data-backdrop="static"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{ crudName }} ListS</h5>
      </div>
      <div class="modal-body form-style-md form-style-font linux">
        <div
          id="hide_alert"
          class="alert alert-danger form-error-message my-4"
          *ngIf="error_msg == true"
        >
          {{ ErrorMsg }}
        </div>
        <form [formGroup]="this.editForm" (ngSubmit)="onSubmit()">
          <div class="form-row">
            <div class="col-md-12">
              <div class="matt-group">
                <mat-label>Name <b class="star">*</b></mat-label>
                <mat-form-field appearance="legacy">
                  <input
                    matInput
                    placeholder=""
                    formControlName="name"
                    maxlength="100"
                  />
                  <mat-error *ngIf="Error('name', 'required')"
                    >Enter name</mat-error
                  >
                  <mat-error *ngIf="Error('name', 'pattern')"
                    >Alphabets characters only</mat-error
                  >
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="form-row button-group-lg mt-2">
            <div class="col-md-12">
              <a
                href="javascript:void(0)"
                class="btn btn-primary w-100"
                *ngIf="crudName == 'View'"
                >View</a
              >
              <button type="submit" class="btn btn-primary" *ngIf="!isReadonly">
                {{ crudName }}
              </button>
              <button
                type="button"
                class="btn btn-outline-primary"
                #closebutton
                data-dismiss="modal"
              >
                Cancel
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade master-modal-style"
  id="approval-modal"
  data-keyboard="false"
  data-backdrop="static"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ approvalType }} Approval
        </h5>
        <button
          type="button"
          class="close"
          title="Close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body form-style-md form-style-font linux">
        <form
          [formGroup]="this.approvalForm"
          id="approvalForm"
          (ngSubmit)="onApprovalSubmit()"
        >
          <div class="form-row">
            <div class="col-md-12 matt-group">
              <a href="javascript:void(0);" (click)="onViewTemp()"
                ><mat-label>View Trial Details</mat-label></a
              >
            </div>
            <div class="col-md-12">
              <div class="matt-group">
                <mat-label>Comments <b class="star">*</b></mat-label>
                <mat-form-field class="example-full-width" appearance="fill">
                  <textarea
                    matInput
                    rows="8"
                    formControlName="notes"
                  ></textarea>
                  <mat-error *ngIf="ErrorApproval('notes', 'required')"
                    >Enter comments</mat-error
                  >
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="form-row button-group-lg button-auto mt-2">
            <div class="col-md-6 col-6">
              <button type="submit" id="approvalSubmit" hidden>SUBMIT</button>
              <button
                type="button"
                class="btn btn-success"
                (click)="onApproval()"
              >
                <span class="material-icons-outlined">thumb_up</span>
              </button>
            </div>
            <div class="col-md-6 col-6 text-left">
              <button
                type="button"
                *ngIf="aTrial && aTrial.approved_level != 1"
                class="btn btn-danger backbtn"
                (click)="onReject()"
              >
                <span class="material-icons-outlined">thumb_down</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade master-modal-style"
  id="trial-status-modal"
  data-keyboard="false"
  data-backdrop="static"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Trials Approval History
        </h5>
        <button
          type="button"
          title="Close"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body form-style-md form-style-font linux">
        <div class="form-row">
          <div class="col-md-12">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Unit/Role</th>
                  <th>Ship</th>
                  <th>Trial Unit</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngIf="selectedTrial">
                  <tr>
                    <td>Initiater</td>
                    <td>
                      <label class="text-success"
                        ><span class="material-icons-outlined">thumb_up</span>
                        <br />
                        {{
                          moment(selectedTrial.created_on).format(
                            "DD-MM-YYYY hh:mm A"
                          )
                        }}</label
                      >
                    </td>
                    <td>
                      <ng-container *ngIf="selectedTrial.trial_initiater">
                        <label
                          class="text-success"
                          *ngIf="selectedTrial.trial_initiater.status == 1"
                          ><span class="material-icons-outlined">thumb_up</span>
                          <br />
                          {{
                            moment(
                              selectedTrial.trial_initiater.approved_on
                            ).format("DD-MM-YYYY hh:mm A")
                          }}</label
                        >
                        <label
                          class="text-danger"
                          *ngIf="selectedTrial.trial_initiater.status == 2"
                          ><span class="material-icons-outlined"
                            >thumb_down</span
                          >
                          ({{ selectedTrial.trial_initiater.comments }}) <br />
                          {{
                            moment(
                              selectedTrial.trial_initiater.approved_on
                            ).format(
                              "DD-MM-YYYY hh:mm
                         A"
                            )
                          }}</label
                        >
                      </ng-container>
                      <ng-container *ngIf="!selectedTrial.trial_initiater">
                        <label class="text-info">NA</label>
                      </ng-container>
                    </td>
                  </tr>
                  <tr>
                    <td>Recommender</td>
                    <td>
                      <ng-container *ngIf="selectedTrial.ship_recommendation">
                        <label
                          class="text-success"
                          *ngIf="selectedTrial.ship_recommendation.status == 1"
                          ><span class="material-icons-outlined">thumb_up</span>
                          ({{ selectedTrial.ship_recommendation.comments }})
                          <br />
                          {{
                            moment(
                              selectedTrial.ship_recommendation.approved_on
                            ).format("DD-MM-YYYY hh:mm A")
                          }}</label
                        >
                        <label
                          class="text-danger"
                          *ngIf="selectedTrial.ship_recommendation.status == 2"
                          ><span class="material-icons-outlined"
                            >thumb_down</span
                          >
                          ({{ selectedTrial.ship_recommendation.comments }})
                          <br />
                          {{
                            moment(
                              selectedTrial.ship_recommendation.approved_on
                            ).format("DD-MM-YYYY hh:mm A")
                          }}</label
                        >
                      </ng-container>
                      <ng-container *ngIf="!selectedTrial.ship_recommendation">
                        <label class="text-info">NA</label>
                      </ng-container>
                    </td>
                    <td>
                      <ng-container *ngIf="selectedTrial.trial_recommendation">
                        <label
                          class="text-success"
                          *ngIf="selectedTrial.trial_recommendation.status == 1"
                          ><span class="material-icons-outlined">thumb_up</span>
                          ({{ selectedTrial.trial_recommendation.comments }})
                          <br />
                          {{
                            moment(
                              selectedTrial.ship_recommendation.approved_on
                            ).format("DD-MM-YYYY hh:mm A")
                          }}</label
                        >
                        <label
                          class="text-danger"
                          *ngIf="selectedTrial.trial_recommendation.status == 2"
                          ><span class="material-icons-outlined"
                            >thumb_down</span
                          >
                          ({{ selectedTrial.trial_recommendation.comments }})
                          <br />
                          {{
                            moment(
                              selectedTrial.trial_recommendation.approved_on
                            ).format(
                              "DD-MM-YYYY hh:mm
                         A"
                            )
                          }}</label
                        >
                      </ng-container>
                      <ng-container *ngIf="!selectedTrial.trial_recommendation">
                        <label class="text-info">NA</label>
                      </ng-container>
                    </td>
                  </tr>
                  <tr>
                    <td>Approver</td>
                    <td>
                      <ng-container *ngIf="selectedTrial.ship_approver">
                        <label
                          class="text-success"
                          *ngIf="selectedTrial.ship_approver.status == 1"
                          ><span class="material-icons-outlined">thumb_up</span>
                          ({{ selectedTrial.ship_approver.comments }}) <br />
                          {{
                            moment(
                              selectedTrial.ship_approver.approved_on
                            ).format("DD-MM-YYYY hh:mm A")
                          }}</label
                        >
                        <label
                          class="text-danger"
                          *ngIf="selectedTrial.ship_approver.status == 2"
                          ><span class="material-icons-outlined"
                            >thumb_down</span
                          >
                          ({{ selectedTrial.ship_approver.comments }}) <br />
                          {{
                            moment(
                              selectedTrial.ship_approver.approved_on
                            ).format(
                              "DD-MM-YYYY hh:mm
                         A"
                            )
                          }}</label
                        >
                      </ng-container>
                      <ng-container *ngIf="!selectedTrial.ship_approver">
                        <label class="text-info">NA</label>
                      </ng-container>
                    </td>
                    <td>
                      <ng-container *ngIf="selectedTrial.trial_approver">
                        <label
                          class="text-success"
                          *ngIf="selectedTrial.trial_approver.status == 1"
                          ><span class="material-icons-outlined">thumb_up</span>
                          ({{ selectedTrial.trial_approver.comments }}) <br />
                          {{
                            moment(
                              selectedTrial.trial_approver.approved_on
                            ).format(
                              "DD-MM-YYYY hh:mm
                         A"
                            )
                          }}</label
                        >
                        <label
                          class="text-danger"
                          *ngIf="selectedTrial.trial_approver.status == 2"
                          ><span class="material-icons-outlined"
                            >thumb_down</span
                          >
                          ({{ selectedTrial.trial_approver.comments }}) <br />
                          {{
                            moment(
                              selectedTrial.trial_approver.approved_on
                            ).format(
                              "DD-MM-YYYY hh:mm
                         A"
                            )
                          }}</label
                        >
                      </ng-container>
                      <ng-container *ngIf="!selectedTrial.trial_approver">
                        <label class="text-info">NA</label>
                      </ng-container>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>

            <div
              class="row d-flex justify-content-center mt-4 mb-70 timeline"
              *ngIf="approvalHistory && approvalHistory.length > 0"
            >
              <div class="col-md-12">
                <div class="main-card mb-3 card">
                  <div class="card-body">
                    <h5 class="card-title">Trials Log</h5>
                    <div
                      class="vertical-timeline vertical-timeline--animate vertical-timeline--one-column"
                    >
                      <ng-container *ngFor="let history of approvalHistory">
                        <div
                          class="vertical-timeline-item vertical-timeline-element"
                        >
                          <div>
                            <span
                              class="vertical-timeline-element-icon bounce-in"
                              *ngIf="history.status == 1"
                            >
                              <i class="badge badge-success"
                                ><span class="material-icons-outlined"
                                  >thumb_up</span
                                ></i
                              >
                            </span>
                            <span
                              class="vertical-timeline-element-icon bounce-in"
                              *ngIf="history.status == 2"
                            >
                              <i class="badge badge-danger"
                                ><span class="material-icons-outlined"
                                  >thumb_down</span
                                ></i
                              >
                            </span>
                            <div
                              class="vertical-timeline-element-content bounce-in"
                            >
                              <h4 class="timeline-title">
                                {{
                                  history.approved_by__first_name +
                                    "
                               " +
                                    history.approved_by__last_name +
                                    " (" +
                                    history.approved_role__name +
                                    " from
                               " +
                                    history.approved_by__process__name +
                                    " )"
                                }}
                              </h4>
                              <p>{{ history.comments }}</p>
                              <span class="vertical-timeline-element-date">{{
                                moment(history.approved_on).format(
                                  "DD-MM-YYYY
                               hh:mm A"
                                )
                              }}</span>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade master-modal-style"
  id="approval-history"
  data-keyboard="false"
  data-backdrop="static"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Trial Approval History
        </h5>
        <button
          type="button"
          class="close"
          title="Close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body form-style-md form-style-font linux">
        <div class="form-row">
          <div class="col-md-12">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Trial No.</th>
                  <th>Level</th>
                  <th>Approval Status</th>
                  <th>Approved Date & Time</th>
                  <th>Approved Role</th>
                  <th>Approved By</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngIf="approvalHistory">
                  <tr *ngFor="let approval of approvalHistory">
                    <!-- <td>{{ approval.trial.trial_number }}</td> -->
                    <td>{{ approval.approved_level }}</td>
                    <td>
                      <label
                        class="badge bg-{{
                          approval.status == 2 ? 'danger' : 'success'
                        }}"
                        >{{
                          approval.status == "1" ? "Approved" : "Rejected"
                        }}</label
                      >
                    </td>
                    <td>
                      {{
                        moment(approval.approved_on).format(
                          "DD-MM-YYYY hh:mm A"
                        )
                      }}
                    </td>
                    <td>{{ approval.approved_role__name }}</td>
                    <td>
                      {{
                        approval.approved_by__first_name +
                          " " +
                          approval.approved_by__last_name
                      }}
                    </td>
                  </tr>
                </ng-container>
                <ng-container *ngIf="!approvalHistory">
                  <tr>
                    <td colspan="6" class="text-center">No approvals found!</td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
